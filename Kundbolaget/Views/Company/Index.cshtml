@model IEnumerable<Kundbolaget.Models.EntityModels.Company>

@{
    ViewBag.Title = "Företag";
}

<h4>Företag</h4>

<div>
    @Html.ActionLink("Skapa Ny", "Create", null, new {@class = "orange-text"}) |
    @Html.ActionLink("Tillbaka", "AdminManager", "Home", null, new {@class = "orange-text"})
</div>
<table>
    <tr>
        <th>
            Namn
        </th>
        <th>
            Besöksadress
        </th>
        <th>
            Land
        </th>
        <th>
            Kontaktperson
        </th>
        <th>
            Email
        </th>
        <th>
            Telefonnummer
        </th>
        <th>
            Leveransadress
        </th>
        <th>
            Moderbolag
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr id="@("companyTableRow" + item.Id)">
            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Address.Street)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Country.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ContactPerson.FirstName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Email)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.PhoneNumber)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.DeliveryAddress.Street)
            </td>
            <td>
                @(item.ParentCompany == null ? Html.DisplayName("Inget") : Html.DisplayName(item.ParentCompany.Name))
            </td>

            <td>
                <a href="@Url.Action("Edit", new {id = item.Id})" class="btn btn-floating small waves-effect waves-light">
                    <i class="material-icons">edit</i>
                </a>
                <a href="@Url.Action("Details", new {id = item.Id})" class="btn btn-floating small waves-effect waves-light">
                    <i class="material-icons">info_outline</i>
                </a>
                <a onclick="openRemovalModal(@item.Id)" href="#" class="btn btn-floating small waves-effect waves-light">
                    <i class="material-icons">clear</i>
                </a>
                <div id="@("modal" + item.Id)" class="modal">
                    <div class="modal-content">
                        <h4>Ta bort @item.Name</h4>
                        <button onclick="deleteCompany(@item.Id)" class="btn">Ja</button>
                        <button onclick="closeRemovalModal(@item.Id)" class="btn">Nej</button>
                    </div>
                </div>
            </td>
        </tr>
    }

</table>
<script>

    var openRemovalModal = id => $("#modal" + id).openModal()

    var closeRemovalModal = id => $("#modal" + id).closeModal()

    var deleteCompany = function(id) {
        $.ajax({
            url: "/Company/DeleteEntity/" + id,
            method: "POST",
            success: function() {
                closeRemovalModal(id)
                $("#companyTableRow" + id).hide("slow")
            }
        })
    }

</script>