@using Kundbolaget.Controllers
@using Kundbolaget.Models.EntityModels
@model IEnumerable<Kundbolaget.Models.EntityModels.Order>
<h2>Oplockade ordrar</h2>
@Html.ActionLink("Tillbaka", "Delivery", "Home", null, new {@class="orange-text"})
<hr/>
<table class="highlight">
    <tr>
        <th>
            Ordernummer
        </th>
        <th>
            Butik
        </th>
        <th>
            Orderdatum
        </th>
        <th>
            Önskat leveransdatum
        </th>
        <th>
            Totalpris
        </th>
        <th>
            Plockad
        </th>
        <th>
            Ändra
        </th>
        <th>
            Plocklista
        </th>
        <th>
            Ta bort
        </th>
    </tr>

    @foreach (var item in Model)
    {
        <tr id="@item.Id">
            <td>
                @Html.DisplayFor(modelItem => item.Id)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Company.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreatedDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.WishedDeliveryDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Price)
            </td>
            <td>
                <a onclick="OrderController(@item.Id,'OrderPicked')" class="btn btn-floating btn-small waves-effect waves-light"><i class="material-icons">check</i></a>
            </td>
            <td>
                <a href="@Url.Action("Index","OrderDetails", new { id = item.Id, companyId = item.Company.ParentCompanyId })" class="btn btn-floating btn-small waves-effect waves-light"><i class="material-icons">update</i></a>

                <a onclick="openEditModal(@item.Id)" href="#" class="btn btn-floating small waves-effect waves-light">
                    <i class="material-icons">clear</i>
                </a>
                <div id="@("modal" + item.Id)" class="modal">
                    <div class="modal-content">
                        <h4>Orderdetaljer</h4>
                        <hr />
                        <table class="table">
                            <tr>
                                <th>
                                    Produkt
                                </th>
                                <th>
                                    Behållare
                                </th>
                                <th>
                                    Volym
                                </th>
                                <th>
                                    Mängd
                                </th>
                                <th>
                                    Pris per kolli
                                </th>
                                <th>
                                    Pris total
                                </th>
                            </tr>

                            @foreach (var orderDetails in item.OrderDetails)
                            {
                                <tr class="row">
                                    <td>
                                        @Html.DisplayFor(modelItem => orderDetails.ProductInfo.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => orderDetails.ProductInfo.Container.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => orderDetails.ProductInfo.Volume.Milliliter)
                                    </td>
                                    <td>
                                        @Html.EditorFor(model => orderDetails.Amount, new { htmlAttributes = new { Value = orderDetails.Amount, id = "amount" + orderDetails.Id } })
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => orderDetails.UnitPrice)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => orderDetails.TotalPrice)
                                    </td>
                                    <td>
                                        <a onclick="OrderDetailsController(@orderDetails.Id, 'SaveOrderDetail')" class="btn btn-floating btn-small waves-effect waves-light"><i class="material-icons">check</i></a>
                                        <a href="@Url.Action("Delete", new { id = orderDetails.Id, orderId = orderDetails.OrderId })" class="btn btn-floating btn-small waves-effect waves-light"><i class="material-icons">clear</i></a>
                                    </td>

                                </tr>
                            }
                        </table>
                        <div>
                            @Html.ActionLink("Skapa +", "Create", "OrderDetails", new { id = item.Id }, new { @class = "waves-effect waves-light btn" })
                        </div>  

                    </div>
                </div>
            </td>
            <td>
                <a href="@Url.Action("OrderDetails", "Order", new {id = item.Id, companyId = item.Company.ParentCompanyId})" class="btn btn-floating btn-small waves-effect waves-light"><i class="material-icons">info_outline</i></a>
            </td>
            <td>
                <a onclick="OrderController(@item.Id,'Delete')" class="btn btn-floating btn-small waves-effect waves-light"><i class="material-icons">delete</i></a>                                
            </td>
        </tr>
    }
</table>
<script src="~/Scripts/CallOrderController.js"></script>
<script src="~/Scripts/CallOrderDetailsController.js"></script>

<script>

    var openEditModal = id => $("#modal" + id).openModal()

    var closeEditModal = id => $("#modal" + id).hidden()

    $("#modal" + id).on('hidden.bs.modal', function () {
        window.alert('hidden event fired!');
    });


    var editOrder = function(id) {
        $.ajax({
            url: "/Order/OrderDetails/" + id,
            method: "POST",
            success: function() {
                closeEditModal(id)
                $("#companyTableRow" + id).hide("slow",
                    () => {
                        location.reload(true)
                    })
            }
        })
    }
</script>
